webpackJsonp([3,6,11],{"1alW":function(e,t,n){var r=n("kM2E");r(r.S,"Number",{isInteger:n("AKgy")})},"5Ft8":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("5mnF"),i=n("f76V"),s=n("VU/8"),a=s(r.a,i.a,null,null,null);t.default=a.exports},"5mnF":function(e,t,n){"use strict";var r=n("woOf"),i=n.n(r),s=n("vMJZ"),a=n("E4LH");t.a={name:"UserEditor",props:{user:{type:Object,default:function(){return{name:"",phone:"",mail:"",password:""}}},onAction:{type:Function,default:null}},data:function(){return{loading:!1,formRules:{name:[{required:!0,trigger:"blur",validator:a.a}],phone:[{required:!0,trigger:"blur",validator:a.b}],password:[{required:!0,trigger:"blur",validator:a.c}]}}},methods:{cancel:function(){this.$refs.form.resetFields(),this.onAction(!1)},submit:function(){var e=this;this.$refs.form.validate(function(t){if(t){e.loading=!0;var r=i()({},e.user);(r.id?n.i(s.f)(r.id,r):n.i(s.g)(r)).then(function(t){e.loading=!1,e.$message({message:"提交成功",type:"success"}),e.onAction(!0),e.$refs.form.resetFields()}).catch(function(){e.loading=!1})}})}}}},AKgy:function(e,t,n){var r=n("EqjI"),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},"D/1m":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",[n("el-input",{attrs:{placeholder:"ID/名字/电话"},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"search"},on:{click:e.search}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.add}})],1),e._v(" "),n("el-form-item",{staticStyle:{float:"right"}},[n("el-button",{on:{click:e.fetchUsers}},[n("i",{staticClass:"fa fa-refresh",attrs:{"aria-hidden":"true"}})])],1)],1)],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.items,"highlight-current-row":""},on:{"selection-change":e.selectionChanged}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"名字",width:"120"}}),e._v(" "),n("el-table-column",{attrs:{label:"会员",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-popover",{ref:"member-popover",attrs:{placement:"top-start",title:t.row.name,width:"200",trigger:"hover",content:t.row.member.level?"到期时间:"+t.row.member.expire_time:"还未开通会员"}}),e._v(" "),n("i",{staticClass:"fa fa-diamond",style:t.row.member.level?"color:red;":"color:gray;",attrs:{"aria-hidden":"true"}}),e._v(" "),n("el-button",{directives:[{name:"popover",rawName:"v-popover:member-popover",arg:"member-popover"}],attrs:{type:"text",size:"small"},on:{click:function(n){e.member(t.$index,t.row)}}},[e._v("\n\t\t\t\t\t"+e._s(t.row.member.level?"续费":"升级"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"phone",label:"电话",width:"160"}}),e._v(" "),n("el-table-column",{attrs:{prop:"regTime",label:"注册时间","min-width":"180"}}),e._v(" "),n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-form",{staticClass:"user-expand",attrs:{"label-position":"left",inline:""}},[n("el-form-item",{attrs:{label:"邮箱"}},[n("span",[e._v(e._s(t.row.mail))])]),e._v(" "),n("el-form-item",{attrs:{label:"登录时间"}},[n("span",[e._v(e._s(t.row.logTime))])]),e._v(" "),t.row.server?n("el-form-item",{attrs:{label:"服务ID"}},[n("router-link",{attrs:{to:"/servers/item/"+t.row.server.id}},[n("el-button",{attrs:{type:"text"}},[e._v(e._s(t.row.server.id))])],1)],1):e._e(),e._v(" "),t.row.server?n("el-form-item",{attrs:{label:"服务器"}},[n("span",[e._v(e._s(t.row.server.hostname))])]):e._e(),e._v(" "),t.row.server?n("el-form-item",{attrs:{label:"服务端口"}},[n("span",[e._v(e._s(t.row.server.port))])]):e._e()],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"small"},on:{click:function(n){e.edit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(n){e.resetPassword(t.$index,t.row)}}},[e._v("重置")]),e._v(" "),n("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(n){e.remove(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),n("el-col",{staticClass:"toolbar",attrs:{span:24}},[n("el-button",{attrs:{type:"danger",disabled:0===this.selection.length},on:{click:e.batchRemove}},[e._v("批量删除")]),e._v(" "),n("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","page-size":e.params.count,total:e.total,"current-page":e.page},on:{"current-change":e.pageChanged}})],1),e._v(" "),n("el-dialog",{attrs:{title:e.editeTitle,"close-on-click-modal":!1},model:{value:e.editerVisible,callback:function(t){e.editerVisible=t},expression:"editerVisible"}},[n("user-editor",{attrs:{onAction:e.onEdited,user:e.editingUser}})],1),e._v(" "),n("el-dialog",{attrs:{title:"会员升级/续费","close-on-click-modal":!1},model:{value:e.memberVisible,callback:function(t){e.memberVisible=t},expression:"memberVisible"}},[n("user-member",{attrs:{onAction:e.onMemberUpdate,uid:e.memberUid}})],1)],1)},i=[],s={render:r,staticRenderFns:i};t.a=s},E4LH:function(e,t,n){"use strict";function r(e){return/^1[0-9]{10}$/.test(e)}function i(e,t,n){r(t)?n():n(new Error("请输入正确的手机号"))}function s(e,t,n){t.length<2?n(new Error("用户名至少2个字符")):n()}function a(e,t,n){t.length<6?n(new Error("密码不能小于6位")):n()}function o(e,t,n){t.length<2||t.length>16?n(new Error("请输入2-16个字")):n()}function l(e,t,n){t.length<8||t.length>255?n(new Error("请输入8-255个字")):n()}function c(e,t,n){t.length>0&&t.length<60?n():n(new Error("服务器地址为必填"))}t.b=i,t.a=s,t.c=a,t.e=o,t.f=l,t.d=c;var u=n("RRo+");n.n(u)},JCUO:function(e,t,n){"use strict";var r=n("woOf"),i=n.n(r),s=n("5Ft8"),a=n("QY6Y"),o=n("vMJZ");t.a={components:{UserEditor:s.default,UserMember:a.default},data:function(){return{params:{search:"",start:0,count:10},keywords:"",items:[],total:0,page:1,loading:!1,selection:[],editeTitle:"",editerVisible:!1,editingUser:{},memberVisible:!1,memberUid:0}},created:function(){this.fetchUsers()},methods:{fetchUsers:function(){var e=this;this.loading=!0,n.i(o.b)(this.params).then(function(t){e.items=t.list,e.total=t.total,e.loading=!1}).catch(function(){e.loading=!1})},pageChanged:function(e){this.params.start=(e-1)*this.params.count,this.fetchUsers()},selectionChanged:function(e){this.selection=e},search:function(){this.params.start=0,this.params.search=this.keywords,this.fetchUsers()},add:function(){this.editeTitle="添加",this.editerVisible=!0,this.editingUser=i()({},{name:"",phone:"",mail:"",password:""})},edit:function(e,t){this.editeTitle="编辑",this.editerVisible=!0,this.editingUser=i()({},t)},onEdited:function(e){this.editerVisible=!1,this.editingUser.id||(this.page=1,this.params.search=""),e&&this.fetchUsers()},member:function(e,t){this.memberUid=t.id,this.memberVisible=!0},onMemberUpdate:function(e){this.memberVisible=!1,this.fetchUsers()},resetPassword:function(e,t){var r=this,i="确认要重置「"+t.name+"」的密码吗?";this.$confirm(i,"提示",{type:"warning"}).then(function(){r.loading=!0,n.i(o.c)(t.id,"123456").then(function(e){r.loading=!1,r.$message({message:"重置密码成功",type:"success"})}).catch(function(){r.loading=!1})})},remove:function(e,t){var r=this,i="确认要删除「"+t.name+"」吗?";this.$confirm(i,"提示",{type:"warning"}).then(function(){r.loading=!0,n.i(o.d)(t.id).then(function(e){r.loading=!1,r.$message({message:"删除成功",type:"success"}),fetchUsers()}).catch(function(){r.loading=!1})})},batchRemove:function(){var e=this,t=this.selection.map(function(e){return e.id}).toString(),r=this.selection.map(function(e){return e.name}).toString(),i="确认要删除「"+r+"」吗?";this.$confirm(i,"提示",{type:"warning"}).then(function(){e.loading=!0,n.i(o.e)(t).then(function(t){e.loading=!1,e.$message({message:"删除成功",type:"success"}),e.fetchUsers()}).catch(function(){e.loading=!1})})}}}},MgpJ:function(e,t,n){t=e.exports=n("FZ+f")(!0),t.push([e.i,".user-expand{font-size:0}.user-expand label{width:70px;color:#99a9bf}.user-expand .el-form-item{margin-right:0;margin-bottom:0;width:33%}","",{version:3,sources:["/var/jenkins_home/workspace/website/modules/admin/src/views/user/index.vue"],names:[],mappings:"AACA,aACE,WAAa,CACd,AACD,mBACI,WAAY,AACZ,aAAe,CAClB,AACD,2BACI,eAAgB,AAChB,gBAAiB,AACjB,SAAW,CACd",file:"index.vue",sourcesContent:["\n.user-expand {\n  font-size: 0;\n}\n.user-expand label {\n    width: 70px;\n    color: #99a9bf;\n}\n.user-expand .el-form-item {\n    margin-right: 0;\n    margin-bottom: 0;\n    width: 33%;\n}\n"],sourceRoot:""}])},QY6Y:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("WwBj"),i=n("XeWg"),s=n("VU/8"),a=s(r.a,i.a,null,null,null);t.default=a.exports},"RRo+":function(e,t,n){e.exports={default:n("c45H"),__esModule:!0}},WwBj:function(e,t,n){"use strict";var r=n("vMJZ");t.a={name:"UserMember",props:{uid:{type:Number,default:0},onAction:{type:Function,default:null}},data:function(){return{loading:!1,member:{days:30}}},methods:{cancel:function(){this.$refs.form.resetFields(),this.onAction(!1)},submit:function(){var e=this;this.loading=!0,n.i(r.a)(this.uid,this.member.days).then(function(t){e.loading=!1,e.$message({message:"提交成功",type:"success"}),e.onAction(!0),e.$refs.form.resetFields()}).catch(function(){e.loading=!1})}},watch:{uid:function(e,t){this.member.days=30}}}},XeWg:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"form",attrs:{model:e.member,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"天数",prop:"days"}},[n("el-input-number",{attrs:{type:"","auto-complete":"off",min:0,step:15,max:1e3},model:{value:e.member.days,callback:function(t){e.member.days=t},expression:"member.days"}})],1),e._v(" "),n("el-form-item",[n("el-button",{nativeOn:{click:function(t){e.cancel(t)}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.loading},nativeOn:{click:function(t){e.submit(t)}}},[e._v("提交")])],1)],1)},i=[],s={render:r,staticRenderFns:i};t.a=s},c45H:function(e,t,n){n("1alW"),e.exports=n("FeBl").Number.isInteger},f76V:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"form",attrs:{model:e.user,"label-width":"80px",rules:e.formRules}},[n("el-form-item",{attrs:{label:"名字",prop:"name"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.user.name,callback:function(t){e.user.name=t},expression:"user.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"电话",prop:"phone"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.user.phone,callback:function(t){e.user.phone=t},expression:"user.phone"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"邮箱",prop:"mail"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.user.mail,callback:function(t){e.user.mail=t},expression:"user.mail"}})],1),e._v(" "),e.user.id?e._e():n("el-form-item",{attrs:{label:"密码",prop:"password"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.user.password,callback:function(t){e.user.password=t},expression:"user.password"}})],1),e._v(" "),n("el-form-item",[n("el-button",{nativeOn:{click:function(t){e.cancel(t)}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.loading},nativeOn:{click:function(t){e.submit(t)}}},[e._v("提交")])],1)],1)},i=[],s={render:r,staticRenderFns:i};t.a=s},md3T:function(e,t,n){"use strict";function r(e){n("nNk7")}Object.defineProperty(t,"__esModule",{value:!0});var i=n("JCUO"),s=n("D/1m"),a=n("VU/8"),o=r,l=a(i.a,s.a,o,null,null);t.default=l.exports},nNk7:function(e,t,n){var r=n("MgpJ");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);n("rjj0")("2f83c7a5",r,!0)},vMJZ:function(e,t,n){"use strict";function r(e){return n.i(u.a)({url:"/users",method:"get",params:e})}function i(e){return n.i(u.a)({url:"/users",method:"post",data:e})}function s(e,t){return n.i(u.a)({url:"/user/"+e,method:"put",data:t})}function a(e){return n.i(u.a)({url:"/user/"+e,method:"delete"})}function o(e){return n.i(u.a)({url:"/users",method:"delete",data:{ids:e}})}function l(e,t){return n.i(u.a)({url:"/user/"+e+"/member",method:"put",data:{days:t}})}function c(e,t){return n.i(u.a)({url:"/user/"+e+"/password",method:"put",data:{password:t}})}t.b=r,t.g=i,t.f=s,t.d=a,t.e=o,t.a=l,t.c=c;var u=n("Vo7i")}});
//# sourceMappingURL=3.1628d649ce393e359cb0.js.map