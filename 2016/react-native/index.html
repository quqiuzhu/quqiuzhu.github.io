<!DOCTYPE html>
<html lang="zh-CN">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="屈秋竹">
    <meta name="description" content="屈秋竹的个人网站">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="React Native"/>
<meta name="twitter:description" content="最近公司开发了一款叫「熊猫洋货」的APP，学习了一些 React Native 的知识，在这里进行一下总结
 环境搭建 React Native 页面 原生应用集成  环境搭建 因为我是一名使用 Mac 的 Android 开发者，所以 Mac下的 Android 环境、HomeBrew 包管理器都已具备。只需要装 Node 和 React Native 命令行工具即可。 安装 Node 主要是希望使用其包管理工具 npm 。安装命令如下
brew install node npm install -g react-native-cli 在此提醒一下，请注意 HomeBrew 的提示，如果有命令没有安装成功，按照 HomeBrew 的提示操作。
React Native 页面 React 推荐使用 JSX 语法来写页面，因为其可读性较强。因为 JSX 是一种类 XML 的语法，对于习惯于使用布局文件的 Android 开发者来说并不陌生。 使用 React Component 来开发我们的应用界面
class Greeting extends Component { render() { return ( &lt;Text&gt;Hello world!"/>


    <base href="https://quqiuzhu.com/2016/react-native/">
    <title>
  React Native · 看见未来
</title>

    <link rel="canonical" href="https://quqiuzhu.com/2016/react-native/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://quqiuzhu.com/css/coder.min.ac37073bc2826cd28ef57364a9fe339de7ebcb26dafc22fd832cb35cf5b1d048.css" integrity="sha256-rDcHO8KCbNKO9XNkqf4znefryyba/CL9gyyzXPWx0Eg=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://quqiuzhu.com/css/custom.css">
    

    <link rel="icon" type="image/png" href="https://quqiuzhu.com/favicon.ico" sizes="32x32">
    <link rel="icon" type="image/png" href="https://quqiuzhu.com/favicon.ico" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.56.0-DEV" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://quqiuzhu.com/">
      看见未来
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://quqiuzhu.com/archives/">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://quqiuzhu.com/about/">关于</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>React Native</h1>
    </header>

    

<p>最近公司开发了一款叫「熊猫洋货」的APP，学习了一些 React Native 的知识，在这里进行一下总结</p>

<ol>
<li>环境搭建</li>
<li>React Native 页面</li>
<li>原生应用集成</li>
</ol>

<!-- more -->

<h2 id="环境搭建">环境搭建</h2>

<p>因为我是一名使用 Mac 的 Android 开发者，所以 Mac下的 Android 环境、HomeBrew 包管理器都已具备。只需要装 Node 和 React Native 命令行工具即可。 安装 Node 主要是希望使用其包管理工具 npm 。安装命令如下</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">brew install node
npm install -g react-native-cli</pre></div>
<p>在此提醒一下，请注意 HomeBrew 的提示，如果有命令没有安装成功，按照 HomeBrew 的提示操作。</p>

<h2 id="react-native-页面">React Native 页面</h2>

<p>React 推荐使用 JSX 语法来写页面，因为其可读性较强。因为 JSX 是一种类 XML 的语法，对于习惯于使用布局文件的 Android 开发者来说并不陌生。 使用 React Component 来开发我们的应用界面</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">class Greeting extends Component {
  render() {
    return (
      &lt;Text&gt;Hello world!&lt;/Text&gt;
    );
  }
}</pre></div>
<p>通过 XML 能给 Componet 传递属性，Component 内部能够通过 <code>this.props</code> 获取到该属性。比如从上面的例子改为从外部接受属性参数的形式。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">class Greeting extends Component {
  render() {
    return (
      &lt;Text&gt;this.props.words&lt;/Text&gt;
    );
  }
}

class App extends Component {
  render() {
    return (
      &lt;Greeting words=&#39;Hello world!&#39;/&gt;
      &lt;Greeting words=&#39;你好!&#39;/&gt;
    );
  }
}</pre></div>
<p>在一个 Component 里面，props 的值是不会变的，如果在 Component 的生命周期内需要改变样式，需要使用 state。 下面该组件一会显示 Hello world!， 一会又显示 你好!</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">class Greeting extends Component {
  constructor(props) {
    super(props);
    this.state = { engish: true };

    setInterval(() =&gt; {
      this.setState({ engish: !this.state.engish });
    }, 1000);
  }
  
  render() {
    return (
      &lt;Text&gt;this.state.english ? &#39;Hello world!&#39; : &#39;你好!&#39; &lt;/Text&gt;
    );
  }
}</pre></div>
<p>Component 能通过 StyleSheet 指定样式, flexbox 布局进行定位元素位置。 上述页面使用 StyleSheet</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">class Greeting extends Component {
  render() {
    return (
      &lt;Text style={styles.bigblue}&gt;Hello world!&lt;/Text&gt;
    );
  }
}

const styles = StyleSheet.create({
  bigblue: {
    color: &#39;blue&#39;,
    fontWeight: &#39;bold&#39;,
    fontSize: 30,
    flex: 1,
    alignSelf: &#39;center&#39;
  }
)</pre></div>
<h2 id="原生应用集成">原生应用集成</h2>

<p>在 Application 中加入下列代码，并将 React 写成的页面打成 bundle 放到 src/assets 下, 并命名为 index.android.js。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"> ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {
   @Override
   public boolean getUseDeveloperSupport() {
       return false;
   }

   @Override
   public List&lt;ReactPackage&gt; getPackages() {
       return Arrays.&lt;ReactPackage&gt;asList(
               new MainReactPackage(),
               new YourReactPackage()
       );
   }
};

@Override
public ReactNativeHost getReactNativeHost() {
   return mReactNativeHost;
}</pre></div>
<p>然后在需要使用 React 的页面使用 ReactRootView 代替，并在该页面维持 ReactInstanceManager 的状态。使用下面的就能展示 React 写的页面了。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">mReactRootView.startReactApplication(reactInstancemanager, moduleName, bundle);</pre></div>
<p>reactInstancemanager 为 Application 中维护的同一个 reactInstancemanager 可以通过 getReactNativeHost.getReactInstanceManager() 获取。</p>

<p>moduleName 为当前页面的模块名</p>

<p>bundle 为 Native 传给 React 的参数</p>

<h3 id="react-如何调用-native-方法">React 如何调用 Native 方法</h3>

<p>可以在 ReactPackage 中返回给 React 一些 Native 实现的 module 实例如下</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">public class YourReactPackage implements ReactPackage {

    @Override
    public List&lt;Class&lt;? extends JavaScriptModule&gt;&gt; createJSModules() {
        return Collections.emptyList();
    }

    @Override
    public List&lt;ViewManager&gt; createViewManagers(
    		ReactApplicationContext reactContext) {
        return Collections.emptyList();
    }

    @Override
    public List&lt;NativeModule&gt; createNativeModules(
            ReactApplicationContext reactContext) {
        List&lt;NativeModule&gt; modules = new ArrayList&lt;&gt;();
        modules.add(new YourModule(reactContext));
        return modules;
    }
}

public class YourModule extends ReactContextBaseJavaModule {

    public YourModule(ReactApplicationContext reactContext) {
        super(reactContext);
    }

    public YourModule(ReactApplicationContext reactContext, 
    							Context context) {
        super(reactContext);
    }

    @ReactMethod
    public void event(String name){
    }</pre></div>
<p>然后在 React 中可以通过 <code>NativeModules.YourModule</code> 访问到 Native 方法，比如上面实现的 event 方法。</p>

<h3 id="native-如何调用-react-方法">Native 如何调用 React 方法</h3>

<p>Native 主动与 React 沟通的方式，不是调用 React 方法，而是用事件通知的方式。首先看 Native 如何发通知。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">public void sendReactEvent(String eventName， WriteableMap params) {
   reactInstanceManager.getCurrentReactContext()
   		.getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)
			.emit(eventName, params);
}</pre></div>
<p>Reac 方面，使用下面的方法监听 Native 发来的事件并作出反应。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">DeviceEventEmitter.addListener(eventName, (params) =&gt; {
	// Do Something
})</pre></div>
<p>&ndash; end &ndash;</p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    <p>
       © 2019
    &nbsp
      
        浙ICP备17015868号
      
    &nbsp
      <span> <a href="https://quqiuzhu.com/index.xml"
        target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20"
          fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="feather feather-rss">
          <path d="M4 11a9 9 0 0 1 9 9"></path>
          <path d="M4 4a16 16 0 0 1 16 16"></path>
          <circle cx="5" cy="19" r="1"></circle>
        </svg></a>
      </span>
    </p>
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
