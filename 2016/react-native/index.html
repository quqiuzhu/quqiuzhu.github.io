<!DOCTYPE html>
<html lang="zh-CN">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="屈秋竹">
    <meta name="description" content="屈秋竹的个人网站">
    <meta name="keywords" content="屈秋竹,秋竹,程序员,站长,工程师,商汤,虎牙,音视频,看见未来">

    <base href="https://quqiuzhu.com/2016/react-native/">
    <title>
  React Native · 看见未来
</title>

    <link rel="canonical" href="https://quqiuzhu.com/2016/react-native/">

    
    <link rel="stylesheet" href="https://s3.pstatp.com/cdn/expire-1-M/normalize/8.0.1/normalize.min.css"/>
    
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1306475_6bvggoehvvm.css" />

    
    
    <link rel="stylesheet" href="https://quqiuzhu.com/css/coder.min.e7f92773eeff2c735118a3ba44689134642453f82cd54f6f58a8f074a49fe506.css" integrity="sha256-5/knc&#43;7/LHNRGKO6RGiRNGQkU/gs1U9vWKjwdKSf5QY="
      crossorigin="anonymous" media="screen" />

    

    <link rel="icon" type="image/png" href="https://quqiuzhu.com/favicon.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://quqiuzhu.com/favicon.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.66.0-DEV" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://quqiuzhu.com/">
      看见未来
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><span class="iconfont icon-menu"></span></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://quqiuzhu.com/posts/">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://quqiuzhu.com/about/">关于</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">React Native</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <span class="iconfont icon-calendar"></span>
              <time datetime='2016-10-30T02:09:53Z'>
                2016-10-30
              </time>
              &nbsp
              <span class="tags">
  <span class="iconfont icon-tag"></span>
    <a href="https://quqiuzhu.com/tags/android/">android</a></span>

            </span>
          </div>
        </div>
      </header>

      <div class="post-content">
        <p>最近公司开发了一款叫「熊猫洋货」的APP，学习了一些 React Native 的知识，在这里进行一下总结</p>
<ol>
<li>环境搭建</li>
<li>React Native 页面</li>
<li>原生应用集成</li>
</ol>
<!-- raw HTML omitted -->
<h2 id="环境搭建">环境搭建</h2>
<p>因为我是一名使用 Mac 的 Android 开发者，所以 Mac下的 Android 环境、HomeBrew 包管理器都已具备。只需要装 Node 和 React Native 命令行工具即可。 安装 Node 主要是希望使用其包管理工具 npm 。安装命令如下</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">brew install node
npm install -g react-native-cli
</code></pre></div><p>在此提醒一下，请注意 HomeBrew 的提示，如果有命令没有安装成功，按照 HomeBrew 的提示操作。</p>
<h2 id="react-native-页面">React Native 页面</h2>
<p>React 推荐使用 JSX 语法来写页面，因为其可读性较强。因为 JSX 是一种类 XML 的语法，对于习惯于使用布局文件的 Android 开发者来说并不陌生。 使用 React Component 来开发我们的应用界面</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">class Greeting extends Component {
  render() {
    return (
      &lt;Text&gt;Hello world!&lt;/Text&gt;
    );
  }
}
</code></pre></div><p>通过 XML 能给 Componet 传递属性，Component 内部能够通过 <code>this.props</code> 获取到该属性。比如从上面的例子改为从外部接受属性参数的形式。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">class Greeting extends Component {
  render() {
    return (
      &lt;Text&gt;this.props.words&lt;/Text&gt;
    );
  }
}

class App extends Component {
  render() {
    return (
      &lt;Greeting words=&#39;Hello world!&#39;/&gt;
      &lt;Greeting words=&#39;你好!&#39;/&gt;
    );
  }
}
</code></pre></div><p>在一个 Component 里面，props 的值是不会变的，如果在 Component 的生命周期内需要改变样式，需要使用 state。 下面该组件一会显示 Hello world!， 一会又显示 你好!</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">class Greeting extends Component {
  constructor(props) {
    super(props);
    this.state = { engish: true };

    setInterval(() =&gt; {
      this.setState({ engish: !this.state.engish });
    }, 1000);
  }
  
  render() {
    return (
      &lt;Text&gt;this.state.english ? &#39;Hello world!&#39; : &#39;你好!&#39; &lt;/Text&gt;
    );
  }
}
</code></pre></div><p>Component 能通过 StyleSheet 指定样式, flexbox 布局进行定位元素位置。 上述页面使用 StyleSheet</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">class Greeting extends Component {
  render() {
    return (
      &lt;Text style={styles.bigblue}&gt;Hello world!&lt;/Text&gt;
    );
  }
}

const styles = StyleSheet.create({
  bigblue: {
    color: &#39;blue&#39;,
    fontWeight: &#39;bold&#39;,
    fontSize: 30,
    flex: 1,
    alignSelf: &#39;center&#39;
  }
)
</code></pre></div><h2 id="原生应用集成">原生应用集成</h2>
<p>在 Application 中加入下列代码，并将 React 写成的页面打成 bundle 放到 src/assets 下, 并命名为 index.android.js。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"> ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {
   @Override
   public boolean getUseDeveloperSupport() {
       return false;
   }

   @Override
   public List&lt;ReactPackage&gt; getPackages() {
       return Arrays.&lt;ReactPackage&gt;asList(
               new MainReactPackage(),
               new YourReactPackage()
       );
   }
};

@Override
public ReactNativeHost getReactNativeHost() {
   return mReactNativeHost;
}
</code></pre></div><p>然后在需要使用 React 的页面使用 ReactRootView 代替，并在该页面维持 ReactInstanceManager 的状态。使用下面的就能展示 React 写的页面了。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">mReactRootView.startReactApplication(reactInstancemanager, moduleName, bundle);
</code></pre></div><p>reactInstancemanager 为 Application 中维护的同一个 reactInstancemanager 可以通过 getReactNativeHost.getReactInstanceManager() 获取。</p>
<p>moduleName 为当前页面的模块名</p>
<p>bundle 为 Native 传给 React 的参数</p>
<h3 id="react-如何调用-native-方法">React 如何调用 Native 方法</h3>
<p>可以在 ReactPackage 中返回给 React 一些 Native 实现的 module 实例如下</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">public class YourReactPackage implements ReactPackage {

    @Override
    public List&lt;Class&lt;? extends JavaScriptModule&gt;&gt; createJSModules() {
        return Collections.emptyList();
    }

    @Override
    public List&lt;ViewManager&gt; createViewManagers(
    		ReactApplicationContext reactContext) {
        return Collections.emptyList();
    }

    @Override
    public List&lt;NativeModule&gt; createNativeModules(
            ReactApplicationContext reactContext) {
        List&lt;NativeModule&gt; modules = new ArrayList&lt;&gt;();
        modules.add(new YourModule(reactContext));
        return modules;
    }
}

public class YourModule extends ReactContextBaseJavaModule {

    public YourModule(ReactApplicationContext reactContext) {
        super(reactContext);
    }

    public YourModule(ReactApplicationContext reactContext, 
    							Context context) {
        super(reactContext);
    }

    @ReactMethod
    public void event(String name){
    }
</code></pre></div><p>然后在 React 中可以通过 <code>NativeModules.YourModule</code> 访问到 Native 方法，比如上面实现的 event 方法。</p>
<h3 id="native-如何调用-react-方法">Native 如何调用 React 方法</h3>
<p>Native 主动与 React 沟通的方式，不是调用 React 方法，而是用事件通知的方式。首先看 Native 如何发通知。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">public void sendReactEvent(String eventName， WriteableMap params) {
   reactInstanceManager.getCurrentReactContext()
   		.getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)
			.emit(eventName, params);
}
</code></pre></div><p>Reac 方面，使用下面的方法监听 Native 发来的事件并作出反应。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">DeviceEventEmitter.addListener(eventName, (params) =&gt; {
	// Do Something
})
</code></pre></div>
      </div>

      <footer>
        <div id="utter-container"></div>
<script src="https://utteranc.es/client.js" repo='quqiuzhu/quqiuzhu.github.io'
    issue-term="title" theme='github-light' crossorigin="anonymous"
    async>
</script>
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>浙ICP备17015868号</p>
        
     © 2020
    
    
  </section>
</footer>

    </main>

    

<script type="text/javascript" src="https://quqiuzhu.com/bundle.min.71f6cc734ea8c75ac28fd27a49444fac11880210be81de4b7bf8c1a7c59871d5a08807d5b36de3de68282328b61032de05fa94ac41c8ff2c4e3992d18d92ae1b.js" integrity="sha512-cfbMc06ox1rCj9J6SURPrBGIAhC&#43;gd5Le/jBp8WYcdWgiAfVs23j3mgoIyi2EDLeBfqUrEHI/yxOOZLRjZKuGw=="></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-140819128-1', 'auto');
	
	ga('send', 'pageview');
}
</script>



  </body>

</html>
