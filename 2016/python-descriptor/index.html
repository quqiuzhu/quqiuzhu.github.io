<!DOCTYPE html>
<html lang="zh-CN">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="屈秋竹">
    <meta name="description" content="屈秋竹的个人网站">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python 学习笔记 描述符"/>
<meta name="twitter:description" content="许多做 C&#43;&#43; 和 Java 的朋友在看 Python 的时候，或许会问，Python 中没有 private, protected, public 等关键字，是怎么控制变量访问的呢？Python 中有没有静态变量，实例变量呢？
Python 没有静态变量和实例变量的区别，只有属性。类的属性还是对象的属性没有任何不同，因为类也是一种对象。Python 中类的属性还包含了类中的方法，而控制属性访问的正是描述符。
本文将详细叙述描述符协议、描述符的实现方式、属性及属性访问顺序等主题。 描述符协议 一个实例 instance 有一个属性 x，对属性 x 有三种操作。 访问 y = instance.x， 赋值 instance.x = 20 和 删除 del instance.x，描述符正是对这三种操作进行控制。
描述符协议有 3 个方法，只要实现 __get__ 或者 __set__ 方法就可以算是一个描述器。实现了 __set__ 方法的描述器是数据描述器，实现了 __get__ 方法，但是没有实现 __set__ 方法的是非数据描述符。两种描述符在属性访问时的优先级不同，后面会讲。
descr.__get__(self, inst, type=None) --&gt; value descr.__set__(self, inst, value) --&gt; None descr.__delete__(self, inst) --&gt; None 描述符协议调用者是属性，所以参数 self 是指属性，inst 指的是实例。
描述符实现方式 有三种典型的方式来实现描述符，类、property() 和 property 装饰器"/>


    <base href="https://quqiuzhu.com/2016/python-descriptor/">
    <title>
  Python 学习笔记 描述符 · 看见未来
</title>

    <link rel="canonical" href="https://quqiuzhu.com/2016/python-descriptor/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://quqiuzhu.com/css/coder.min.ac37073bc2826cd28ef57364a9fe339de7ebcb26dafc22fd832cb35cf5b1d048.css" integrity="sha256-rDcHO8KCbNKO9XNkqf4znefryyba/CL9gyyzXPWx0Eg=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://quqiuzhu.com/css/custom.css">
    

    <link rel="icon" type="image/png" href="https://quqiuzhu.com/favicon.ico" sizes="32x32">
    <link rel="icon" type="image/png" href="https://quqiuzhu.com/favicon.ico" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.56.0-DEV" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://quqiuzhu.com/">
      看见未来
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://quqiuzhu.com/archives/">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://quqiuzhu.com/about/">关于</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Python 学习笔记 描述符</h1>
    </header>

    

<p>许多做 C++ 和 Java 的朋友在看 Python 的时候，或许会问，Python 中没有 <code>private</code>, <code>protected</code>, <code>public</code> 等关键字，是怎么控制变量访问的呢？Python 中有没有静态变量，实例变量呢？</p>

<p>Python 没有静态变量和实例变量的区别，只有属性。类的属性还是对象的属性没有任何不同，因为类也是一种对象。Python 中类的属性还包含了类中的方法，而控制属性访问的正是描述符。</p>

<p>本文将详细叙述描述符协议、描述符的实现方式、属性及属性访问顺序等主题。
<!-- more --></p>

<h2 id="描述符协议">描述符协议</h2>

<p>一个实例 instance 有一个属性 x，对属性 x 有三种操作。 访问 <code>y = instance.x</code>， 赋值 <code>instance.x = 20</code> 和 删除 <code>del instance.x</code>，描述符正是对这三种操作进行控制。</p>

<p>描述符协议有 3 个方法，只要实现 <code>__get__</code> 或者 <code>__set__</code> 方法就可以算是一个描述器。实现了 <code>__set__</code> 方法的描述器是数据描述器，实现了 <code>__get__</code> 方法，但是没有实现 <code>__set__</code> 方法的是非数据描述符。两种描述符在属性访问时的优先级不同，后面会讲。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">descr.__get__(self, inst, type=None) --&gt; value
descr.__set__(self, inst, value) --&gt; None
descr.__delete__(self, inst) --&gt; None</code></pre></div>
<p>描述符协议调用者是属性，所以参数 self 是指属性，inst 指的是实例。</p>

<h2 id="描述符实现方式">描述符实现方式</h2>

<p>有三种典型的方式来实现描述符，类、property() 和 property 装饰器</p>

<h3 id="类">类</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="font-weight:bold">class</span> <span style="font-weight:bold">NameDescripter</span>(object):
    <span style="font-weight:bold">def</span> __init__(self):
        self._name = <span style="font-style:italic">&#39;&#39;</span>

    <span style="font-weight:bold">def</span> __get__(self, instance, inst_type):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__get__&#39;</span>, self._name
        <span style="font-weight:bold">return</span> self._name

    <span style="font-weight:bold">def</span> __set__(self, instance, value):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__set__&#39;</span>, self._name
        self._name = value

    <span style="font-weight:bold">def</span> __delete__(self, instance):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__delete__&#39;</span>, self._name
        self._name = <span style="font-style:italic">&#39;&#39;</span>

<span style="font-weight:bold">class</span> <span style="font-weight:bold">Person</span>(object):
    name = NameDescripter()
    
user = Person()
user.name = <span style="font-style:italic">&#39;quqiuzhu&#39;</span> 
out: __set__
user.name  
out: __get__ quqiuzhu
<span style="font-weight:bold">del</span> user.name
out: __delete__ quqiuzhu
user.name
out: __get__</code></pre></div>
<h3 id="property">property()</h3>

<p>property() 定义如下:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">property(fget=None, fset=None, fdel=None, doc=None) -&gt; property attribute</code></pre></div>
<p>用该函数实现上一节的 Person name 属性</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="font-weight:bold">class</span> <span style="font-weight:bold">Person</span>(object):
    <span style="font-weight:bold">def</span> __init__(self):
        self._name = <span style="font-style:italic">&#39;&#39;</span>

    <span style="font-weight:bold">def</span> __get_name(self):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__get__&#39;</span>, self._name
        <span style="font-weight:bold">return</span> self._name

    <span style="font-weight:bold">def</span> __set_name(self, value):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__set__&#39;</span>, self._name
        self._name = value

    <span style="font-weight:bold">def</span> __del_name(self):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__delete__&#39;</span>, self._name
        self._name = <span style="font-style:italic">&#39;&#39;</span>
    name = property(__get_name, __set_name, __del_name)</code></pre></div>
<h3 id="property-装饰器">property 装饰器</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="font-weight:bold">class</span> <span style="font-weight:bold">Person</span>(object):
    <span style="font-weight:bold">def</span> __init__(self):
        self._name = <span style="font-style:italic">&#39;&#39;</span>
        
    @property
    <span style="font-weight:bold">def</span> name(self):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__get__&#39;</span>, self._name
        <span style="font-weight:bold">return</span> self._name

    @name.setter
    <span style="font-weight:bold">def</span> name(self, value):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__set__&#39;</span>, self._name
        self._name = value

    @name.deleter
    <span style="font-weight:bold">def</span> name(self):
        <span style="font-weight:bold">print</span> <span style="font-style:italic">&#39;__delete__&#39;</span>, self._name
        self._name = <span style="font-style:italic">&#39;&#39;</span></code></pre></div>
<h2 id="方法描述符">方法描述符</h2>

<p>方法是一种特殊的属性，其描述符实现原理如下</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="font-weight:bold">class</span> <span style="font-weight:bold">Function</span>(object):
    . . .
    <span style="font-weight:bold">def</span> __get__(self, obj, objtype=None):
        <span style="font-style:italic">&#34;Simulate func_descr_get() in Objects/funcobject.c&#34;</span>
        <span style="font-weight:bold">return</span> types.MethodType(self, obj, objtype)</code></pre></div>
<p>Python 中 <code>.</code> 是 <code>getattr()</code> 函数的语法糖。所以方法调用 <code>object.func()</code> 相当于 <code>getattr(object, 'func') 然后调用 __call__()</code>。当然，获取属性的方式不只是 <code>getattr(object, 'func')</code> 那么简单，获取属性是一连串的序列的判断和调用，下面会讲。</p>

<h2 id="属性">属性</h2>

<p>属性的查找遵循LEGB原则：Local，Enclosing，Global以及Builtin。现在实例中找，找不到就去类中找，再去父类中找，一直找到 object 还找不到就去。</p>

<p>上面只是罗列一些点，但并没有展开，强烈推荐三篇参考的文章，比 Python Expert Programming 写得清晰很多。</p>

<h3 id="参考">参考</h3>

<p>[1]  <a href="https://www.ibm.com/developerworks/cn/opensource/os-pythondescriptors/">Python 描述符简介</a>
[2]  <a href="http://pyzh.readthedocs.org/en/latest/Descriptor-HOW-TO-Guide.html">Python 描述器引导(翻译)</a>
[3]  <a href="http://wlwang41.github.io/content/python/python%E4%B8%AD%E7%9A%84attributes.html">Python 中的attributes</a></p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    <p>
       © 2019
    &nbsp
      
        浙ICP备17015868号
      
    &nbsp
      <span> <a href="https://quqiuzhu.com/index.xml"
        target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20"
          fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="feather feather-rss">
          <path d="M4 11a9 9 0 0 1 9 9"></path>
          <path d="M4 4a16 16 0 0 1 16 16"></path>
          <circle cx="5" cy="19" r="1"></circle>
        </svg></a>
      </span>
    </p>
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
